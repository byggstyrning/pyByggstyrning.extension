<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Create Spaces from Linked Model" 
        Width="500" 
        Height="440"
        MinWidth="400"
        MinHeight="400"
        ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="CenterScreen"
        ShowInTaskbar="True"
        Background="{DynamicResource WindowBackgroundBrush}">
    
    <!-- Styles will be loaded programmatically -->
    
    <Grid>
        <!-- Main Content -->
        <Grid Margin="15">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Linked Model Selection -->
            <StackPanel Grid.Row="0" Margin="0,0,0,15">
                <TextBlock Text="Select Linked Model with Rooms:" 
                           Style="{DynamicResource SubheaderTextBlockStyle}" 
                           Margin="0,0,0,5"/>
                <ComboBox x:Name="linkedModelComboBox" 
                          Style="{DynamicResource StandardComboBoxStyle}"
                          Height="30">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding display_name}" 
                                       Foreground="{DynamicResource TextBrush}"
                                       VerticalAlignment="Center"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>
            
            <!-- Options Section -->
            <GroupBox Grid.Row="1" Header="Options" Margin="0,0,0,15"
                      Style="{DynamicResource StandardGroupBoxStyle}">
                <StackPanel Margin="5">
                    <CheckBox x:Name="writeParamsCheckBox" 
                              Content="Write Name and Number from Room to Space" 
                              IsChecked="True"
                              Style="{DynamicResource StandardCheckBoxStyle}"
                              Margin="0,5,0,5"/>
                    <CheckBox x:Name="removeExistingCheckBox" 
                              Content="Remove existing spaces before creating" 
                              IsChecked="True"
                              Style="{DynamicResource StandardCheckBoxStyle}"
                              Margin="0,5,0,5"/>
                    
                    <!-- Re-tag option with conditional tag type selector -->
                    <CheckBox x:Name="retagSpacesCheckBox" 
                              Content="Attempt to re-tag new spaces" 
                              IsChecked="False"
                              Style="{DynamicResource StandardCheckBoxStyle}"
                              Margin="0,10,0,5"
                              Checked="RetagCheckBox_Changed"
                              Unchecked="RetagCheckBox_Changed"/>
                    
                    <!-- Tag type selector - disabled unless re-tag is checked -->
                    <StackPanel Orientation="Horizontal" Margin="20,5,0,5">
                        <TextBlock Text="Tag Type:" 
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"
                                   Foreground="{DynamicResource TextBrush}"/>
                        <ComboBox x:Name="tagTypeComboBox"
                                  Width="280"
                                  Height="26"
                                  IsEnabled="False"
                                  Style="{DynamicResource StandardComboBoxStyle}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding display_name}" 
                                               Foreground="{DynamicResource TextBrush}"
                                               VerticalAlignment="Center"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
            
        
            <!-- Buttons -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button x:Name="createButton" 
                        Content="Create Spaces" 
                        Width="120" 
                        Height="30"
                        IsDefault="True" 
                        Style="{DynamicResource StandardButtonStyle}"
                        Margin="0,0,10,0"
                        Click="CreateButton_Click"/>
            </StackPanel>
        </Grid>
        
        <!-- Busy Indicator Overlay - placed AFTER content so it renders on top -->
        <Border x:Name="busyOverlay" 
                Background="#80000000"
                Visibility="Collapsed"
                Panel.ZIndex="100">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <Border Background="{DynamicResource WindowBackgroundBrush}" 
                        CornerRadius="5" 
                        Padding="20"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1">
                    <StackPanel>
                        <ProgressBar x:Name="busyProgressBar" 
                                     IsIndeterminate="True" 
                                     Width="200" 
                                     Height="20"
                                     Margin="0,0,0,10"/>
                        <TextBlock x:Name="busyTextBlock" 
                                   Text="Creating spaces..." 
                                   HorizontalAlignment="Center"
                                   Foreground="{DynamicResource TextBrush}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>
    </Grid>
</Window>
