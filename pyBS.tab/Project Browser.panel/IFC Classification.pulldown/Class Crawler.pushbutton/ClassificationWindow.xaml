<Window 
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="IFC Classification" 
    Height="700" 
    Width="1200"
    ResizeMode="CanResizeWithGrip"
    WindowStartupLocation="CenterScreen"
    ShowInTaskbar="True"
    Background="{DynamicResource WindowBackgroundBrush}"
    PreviewKeyDown="Window_PreviewKeyDown">
    
    <!-- Styles will be loaded programmatically -->
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="350"/>
        </Grid.ColumnDefinitions>
        
        <!-- Main Content Area (Left) -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
        
        <!-- Header -->
        <TextBlock Grid.Row="0" 
                  Text="IFC Classification" 
                  Style="{DynamicResource HeaderTextBlockStyle}" 
                  Margin="10,10,10,10"/>
        
        <!-- Search and Filter Row -->
        <Grid Grid.Row="1" Margin="10,0,10,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBox x:Name="searchTextBox" 
                    Grid.Column="0"
                    Style="{DynamicResource PlaceholderTextBoxStyle}"
                    Tag="Search..."
                    Margin="0,0,10,0"/>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <!-- searchIfcClassesButton removed temporarily for debugging -->
                <!--
                <Button x:Name="searchIfcClassesButton" 
                       Content="ðŸ” Search IFC Classes" 
                       Style="{DynamicResource StandardButtonStyle}"
                       Margin="0,0,5,0"
                       Padding="10,4"
                       Click="SearchIfcClassesButton_Click"/>
                -->
                <Button x:Name="selectAllButton" 
                       Content="Select All" 
                       Style="{DynamicResource StandardButtonStyle}"
                       Margin="0,0,5,0"
                       Padding="10,4"/>
                <Button x:Name="deselectAllButton" 
                       Content="Deselect All" 
                       Style="{DynamicResource StandardButtonStyle}"
                       Padding="10,4"/>
            </StackPanel>
        </Grid>
        
        <!-- DataGrid -->
        <DataGrid x:Name="elementTypesDataGrid" 
                 Grid.Row="2"
                 Margin="10,0"
                 AutoGenerateColumns="False"
                 CanUserAddRows="False"
                 CanUserDeleteRows="False"
                 CanUserReorderColumns="False"
                 SelectionMode="Extended"
                 SelectionUnit="FullRow"
                 GridLinesVisibility="Horizontal"
                 HeadersVisibility="Column"
                 RowHeight="24"
                 EnableRowVirtualization="True"
                 EnableColumnVirtualization="True"
                 VirtualizingStackPanel.IsVirtualizing="True"
                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                 Background="{DynamicResource WindowBackgroundBrush}"
                 RowBackground="{DynamicResource ControlBackgroundBrush}"
                 AlternatingRowBackground="{DynamicResource BackgroundLightBrush}"
                 BorderBrush="{DynamicResource BorderBrush}"
                 BorderThickness="1"
                 HorizontalGridLinesBrush="{DynamicResource BorderBrush}">
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                    <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Style.Triggers>
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsSelected" Value="False"/>
                                <Condition Property="IsMouseOver" Value="False"/>
                            </MultiTrigger.Conditions>
                            <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
                        </MultiTrigger>
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsSelected" Value="False"/>
                                <Condition Property="IsMouseOver" Value="True"/>
                            </MultiTrigger.Conditions>
                            <Setter Property="Background" Value="{DynamicResource BackgroundLighterBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
                        </MultiTrigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                            <Setter Property="Foreground" Value="White"/>
                        </Trigger>
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsSelected" Value="True"/>
                                <Condition Property="IsMouseOver" Value="True"/>
                            </MultiTrigger.Conditions>
                            <Setter Property="Background" Value="{DynamicResource AccentHoverBrush}"/>
                            <Setter Property="Foreground" Value="White"/>
                        </MultiTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
            <DataGrid.Columns>
                <DataGridCheckBoxColumn Header="" 
                                       Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" 
                                       Width="30"
                                       CanUserResize="False"/>
                <DataGridTextColumn Header="Category" 
                                   Binding="{Binding Category}" 
                                   Width="120" 
                                   IsReadOnly="True">
                    <DataGridTextColumn.HeaderTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" 
                                          Text="Category" 
                                          VerticalAlignment="Center"
                                          Margin="0,0,5,0"/>
                                <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
                                    <Button x:Name="SortAscButton"
                                           Content="â–²"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Top"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortAscButton_Click"
                                           Tag="Category">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <Button x:Name="SortDescButton"
                                           Content="â–¼"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0,1,0,0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Bottom"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortDescButton_Click"
                                           Tag="Category">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </DataGridTextColumn.HeaderTemplate>
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="Padding" Value="4,0"/>
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                            <Setter Property="Foreground" Value="{Binding Foreground, RelativeSource={RelativeSource AncestorType=DataGridRow}}"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="Family" 
                                   Binding="{Binding Family}" 
                                   Width="*" 
                                   IsReadOnly="True">
                    <DataGridTextColumn.HeaderTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" 
                                          Text="Family" 
                                          VerticalAlignment="Center"
                                          Margin="0,0,5,0"/>
                                <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
                                    <Button x:Name="SortAscButton"
                                           Content="â–²"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Top"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortAscButton_Click"
                                           Tag="Family">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <Button x:Name="SortDescButton"
                                           Content="â–¼"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0,1,0,0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Bottom"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortDescButton_Click"
                                           Tag="Family">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </DataGridTextColumn.HeaderTemplate>
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="Padding" Value="4,0"/>
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                            <Setter Property="Foreground" Value="{Binding Foreground, RelativeSource={RelativeSource AncestorType=DataGridRow}}"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="Type" 
                                   Binding="{Binding TypeName}" 
                                   Width="*" 
                                   IsReadOnly="True">
                    <DataGridTextColumn.HeaderTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" 
                                          Text="Type" 
                                          VerticalAlignment="Center"
                                          Margin="0,0,5,0"/>
                                <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
                                    <Button x:Name="SortAscButton"
                                           Content="â–²"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Top"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortAscButton_Click"
                                           Tag="TypeName">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <Button x:Name="SortDescButton"
                                           Content="â–¼"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0,1,0,0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Bottom"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortDescButton_Click"
                                           Tag="TypeName">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </DataGridTextColumn.HeaderTemplate>
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="Padding" Value="4,0"/>
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                            <Setter Property="Foreground" Value="{Binding Foreground, RelativeSource={RelativeSource AncestorType=DataGridRow}}"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="Manufacturer" 
                                   Binding="{Binding Manufacturer}" 
                                   Width="120" 
                                   IsReadOnly="True">
                    <DataGridTextColumn.HeaderTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" 
                                          Text="Manufacturer" 
                                          VerticalAlignment="Center"
                                          Margin="0,0,5,0"/>
                                <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
                                    <Button x:Name="SortAscButton"
                                           Content="â–²"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Top"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortAscButton_Click"
                                           Tag="Manufacturer">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <Button x:Name="SortDescButton"
                                           Content="â–¼"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0,1,0,0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Bottom"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortDescButton_Click"
                                           Tag="Manufacturer">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </DataGridTextColumn.HeaderTemplate>
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="Padding" Value="4,0"/>
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                            <Setter Property="Foreground" Value="{Binding Foreground, RelativeSource={RelativeSource AncestorType=DataGridRow}}"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <!-- IFC Class Column (Editable) -->
                <DataGridTemplateColumn Header="IFC Class" Width="150" CanUserResize="False" IsReadOnly="False">
                    <DataGridTemplateColumn.HeaderTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" 
                                          Text="IFC Class" 
                                          VerticalAlignment="Center"
                                          Margin="0,0,5,0"/>
                                <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
                                    <Button x:Name="SortAscButton"
                                           Content="â–²"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Top"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortAscButton_Click"
                                           Tag="IfcClass">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <Button x:Name="SortDescButton"
                                           Content="â–¼"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0,1,0,0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Bottom"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortDescButton_Click"
                                           Tag="IfcClass">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.HeaderTemplate>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock x:Name="ifcClassText" 
                                          Text="{Binding IfcClass}" 
                                          VerticalAlignment="Center" 
                                          Margin="5,0"/>
                                <StackPanel x:Name="processingSpinner" 
                                           Orientation="Horizontal" 
                                           VerticalAlignment="Center" 
                                           HorizontalAlignment="Left"
                                           Margin="5,0"
                                           Visibility="Collapsed">
                                    <TextBlock Text="â³" 
                                              FontSize="14" 
                                              VerticalAlignment="Center" 
                                              Margin="0,0,5,0"/>
                                    <TextBlock x:Name="processingText"
                                              Text="Processing..." 
                                              FontSize="11" 
                                              Foreground="{DynamicResource TextSecondaryBrush}"
                                              VerticalAlignment="Center"/>
                                </StackPanel>
                                <StackPanel x:Name="queuedSpinner" 
                                           Orientation="Horizontal" 
                                           VerticalAlignment="Center" 
                                           HorizontalAlignment="Left"
                                           Margin="5,0"
                                           Visibility="Collapsed">
                                    <TextBlock Text="â³" 
                                              FontSize="14" 
                                              VerticalAlignment="Center" 
                                              Margin="0,0,5,0"/>
                                    <TextBlock Text="In processing queue..." 
                                              FontSize="11" 
                                              Foreground="{DynamicResource TextSecondaryBrush}"
                                              VerticalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                            <DataTemplate.Triggers>
                                <DataTrigger Binding="{Binding IsProcessing}" Value="True">
                                    <Setter TargetName="ifcClassText" Property="Visibility" Value="Collapsed"/>
                                    <Setter TargetName="processingSpinner" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="queuedSpinner" Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsQueued}" Value="True">
                                    <Setter TargetName="ifcClassText" Property="Visibility" Value="Collapsed"/>
                                    <Setter TargetName="queuedSpinner" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="processingSpinner" Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <Border BorderThickness="0" ClipToBounds="True">
                                <TextBox x:Name="ifcClassTextBox"
                                        Text="{Binding IfcClass, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                        VerticalAlignment="Center" 
                                        Margin="0"
                                        Padding="5,0"
                                        HorizontalScrollBarVisibility="Hidden"
                                        VerticalScrollBarVisibility="Hidden"
                                        BorderThickness="0"
                                        Focusable="True"
                                        Background="{DynamicResource ControlBackgroundBrush}"
                                        Foreground="{DynamicResource TextBrush}"
                                        TextWrapping="NoWrap"
                                        AcceptsReturn="False">
                                    <TextBox.Template>
                                        <ControlTemplate TargetType="TextBox">
                                            <Border Background="{TemplateBinding Background}"
                                                    BorderThickness="0"
                                                    ClipToBounds="True">
                                                <ScrollViewer x:Name="PART_ContentHost" 
                                                              HorizontalScrollBarVisibility="Hidden"
                                                              VerticalScrollBarVisibility="Hidden"
                                                              Margin="0"
                                                              CanContentScroll="False">
                                                    <ScrollViewer.Template>
                                                        <ControlTemplate TargetType="ScrollViewer">
                                                            <ScrollContentPresenter Content="{TemplateBinding Content}"
                                                                                  ContentTemplate="{TemplateBinding ContentTemplate}"
                                                                                  Margin="{TemplateBinding Padding}"/>
                                                        </ControlTemplate>
                                                    </ScrollViewer.Template>
                                                </ScrollViewer>
                                            </Border>
                                        </ControlTemplate>
                                    </TextBox.Template>
                                </TextBox>
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellEditingTemplate>
                </DataGridTemplateColumn>
                <!-- Predefined Type Column (Editable) -->
                <DataGridTemplateColumn Header="Predefined Type" Width="130" CanUserResize="False">
                    <DataGridTemplateColumn.HeaderTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" 
                                          Text="Predefined Type" 
                                          VerticalAlignment="Center"
                                          Margin="0,0,5,0"/>
                                <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
                                    <Button x:Name="SortAscButton"
                                           Content="â–²"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Top"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortAscButton_Click"
                                           Tag="PredefinedType">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <Button x:Name="SortDescButton"
                                           Content="â–¼"
                                           FontSize="8"
                                           Padding="2,0"
                                           Margin="0,1,0,0"
                                           Height="10"
                                           Width="16"
                                           VerticalAlignment="Bottom"
                                           HorizontalAlignment="Center"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Cursor="Hand"
                                           Click="SortDescButton_Click"
                                           Tag="PredefinedType">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.HeaderTemplate>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding PredefinedType}" VerticalAlignment="Center" Margin="5,0"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <Border BorderThickness="0" ClipToBounds="True">
                                <TextBox x:Name="predefinedTypeTextBox"
                                        Text="{Binding PredefinedType, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                        VerticalAlignment="Center" 
                                        Margin="0"
                                        Padding="5,0"
                                        HorizontalScrollBarVisibility="Hidden"
                                        VerticalScrollBarVisibility="Hidden"
                                        BorderThickness="0"
                                        Focusable="True"
                                        Background="{DynamicResource ControlBackgroundBrush}"
                                        Foreground="{DynamicResource TextBrush}"
                                        TextWrapping="NoWrap"
                                        AcceptsReturn="False">
                                    <TextBox.Template>
                                        <ControlTemplate TargetType="TextBox">
                                            <Border Background="{TemplateBinding Background}"
                                                    BorderThickness="0"
                                                    ClipToBounds="True">
                                                <ScrollViewer x:Name="PART_ContentHost" 
                                                              HorizontalScrollBarVisibility="Hidden"
                                                              VerticalScrollBarVisibility="Hidden"
                                                              Margin="0"
                                                              CanContentScroll="False">
                                                    <ScrollViewer.Template>
                                                        <ControlTemplate TargetType="ScrollViewer">
                                                            <ScrollContentPresenter Content="{TemplateBinding Content}"
                                                                                  ContentTemplate="{TemplateBinding ContentTemplate}"
                                                                                  Margin="{TemplateBinding Padding}"/>
                                                        </ControlTemplate>
                                                    </ScrollViewer.Template>
                                                </ScrollViewer>
                                            </Border>
                                        </ControlTemplate>
                                    </TextBox.Template>
                                </TextBox>
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellEditingTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
        
        <!-- Status Bar -->
        <Border Grid.Row="3" 
               Style="{DynamicResource StatusBarBorderStyle}"
               Margin="10,8,10,0">
            <TextBlock x:Name="statusTextBlock" 
                      Text="0 of 0 selected" 
                      Style="{DynamicResource BodyTextBlockStyle}"
                      Margin="8,6"/>
        </Border>
        
        <!-- Action Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="10">
            <Button x:Name="getAiSuggestionsButton" 
                   Content="Get AI Suggestions" 
                   Style="{DynamicResource StandardButtonStyle}"
                   Click="GetAiSuggestionsButton_Click"
                   Margin="0,0,10,0"
                   Width="140"/>
            <Button x:Name="updateButton" 
                   Content="Update Selected" 
                   Style="{DynamicResource SuccessButtonStyle}"
                   Click="UpdateButton_Click"
                   Width="120"/>
        </StackPanel>
        </Grid>
        
        <!-- IFC Search Panel (Right Column) -->
        <Border Grid.Column="1" 
               BorderBrush="{DynamicResource BorderBrush}"
               BorderThickness="1,0,0,0"
               Background="{DynamicResource BackgroundLightBrush}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Header with Reference Link -->
                <Grid Grid.Row="0" Margin="15,15,15,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0"
                              Text="IFC Class Search" 
                              Style="{DynamicResource SubheaderTextBlockStyle}"
                              VerticalAlignment="Center"/>
                    
                    <Button x:Name="ifcReferenceButton"
                           Grid.Column="1"
                           Content="ðŸŒ Reference"
                           Style="{DynamicResource StandardButtonStyle}"
                           Padding="8,4"
                           ToolTip="Open Bonsai BIM IFC Class Reference"
                           Click="IfcReferenceButton_Click"/>
                </Grid>
                
                <!-- Search and Version Selection -->
                <Grid Grid.Row="1" Margin="15,0,15,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBox x:Name="ifcSearchTextBox" 
                            Grid.Column="0"
                            Style="{DynamicResource PlaceholderTextBoxStyle}"
                            Tag="Search IFC classes..."
                            Margin="0,0,8,0"/>
                    
                    <ComboBox x:Name="schemaVersionComboBox"
                             Grid.Column="1"
                             SelectedIndex="0"
                             MinWidth="100">
                        <ComboBoxItem Content="IFC2X3"/>
                        <ComboBoxItem Content="IFC4"/>
                        <ComboBoxItem Content="IFC4X3"/>
                    </ComboBox>
                </Grid>
                
                <!-- Results Container -->
                <Border Grid.Row="2" 
                       x:Name="ifcResultsContainer" 
                       Margin="15,0,15,15"
                       BorderBrush="{DynamicResource BorderBrush}"
                       BorderThickness="1"
                       Background="{DynamicResource ControlBackgroundBrush}">
                    <!-- ListBox will be created programmatically here -->
                </Border>
            </Grid>
        </Border>
        
    </Grid>
</Window>
